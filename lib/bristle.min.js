!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(t.bristle=t.bristle||{})}(this,function(t){"use strict";var n={nil:-1,moveTo:0,lineTo:1,bezierTo:2,quadTo:3},r=function(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0];return t[r]=n.moveTo,t[r+1]=i[0],t[r+2]=i[1],r+=3},i=function(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0];return t[r]=n.lineTo,t[r+1]=i[0],t[r+2]=i[1],r+=3},e=function(t,r,i,e){return t[r]=n.quadTo,t[r+1]=i[0],t[r+2]=i[1],t[r+3]=e[0],t[r+4]=e[1],r+=5},o=function(t,r,i,e,o){return t[r]=n.bezierTo,t[r+1]=i[0],t[r+2]=i[1],t[r+3]=e[0],t[r+4]=e[1],t[r+5]=o[0],t[r+6]=o[1],r+7},s=function(t,n,r){return t[n]=r[0],t[n+1]=r[1],n+2},u=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Math.max(t-2,Math.max(n,0))},c=function(t,n,r){return t[0]=n[0]+r[0],t[1]=n[1]+r[1],t},h=function(t,n,r){return c(t,n,r)},f=function(t,n){var r=[[0,0],[0,0],[0,0]];return{moveTo:function(i,e){var o=n(r[0],i.slice(e+1,e+3));return t.moveTo(o[0],o[1]),e+3},lineTo:function(i,e){var o=n(r[0],i.slice(e+1,e+3));return t.lineTo(o[0],o[1]),e+3},quadTo:function(i,e){var o=n(r[0],i.slice(e+1,e+3)),s=n(r[1],i.slice(e+3,e+5));return t.quadraticCurveTo(o[0],o[1],s[0],s[1]),e+5},bezierTo:function(i,e){var o=n(r[0],i.slice(e+1,e+3)),s=n(r[1],i.slice(e+3,e+5)),u=n(r[2],i.slice(e+5,e+7));return t.bezierCurveTo(o[0],o[1],s[0],s[1],u[0],u[1]),e+7}}},a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d=function(t,n){return n=n||{},t.instructions=n.instructions||[],t.iIndex=Number.isInteger(n.instructionIndex)?n.instructionIndex:0,t.transforms=n.transforms||[],t.tIndex=Number.isInteger(n.transformIndex)?n.transformIndex:0,t.tLowerBound=Number.isInteger(n.transformLowerBound)?n.transformLowerBound:0,t.instructor=n.instructor,t},m=function(t,n){return n<t.length&&(t[n]=-1),t},T={cache:[[0,0],[0,0],[0,0]],moveTo:function(t){return this.iIndex=r(this.instructions,this.iIndex,this.applyTransform(this.cache[0],this.getTransform(this.cache[0]),t)),this},lineTo:function(t){return this.iIndex=i(this.instructions,this.iIndex,this.applyTransform(this.cache[0],this.getTransform(this.cache[0]),t)),this},quadTo:function(t,n){return this.iIndex=e(this.instructions,this.iIndex,this.applyTransform(this.cache[0],this.getTransform(this.cache[0]),t),this.applyTransform(this.cache[1],this.getTransform(this.cache[1]),n)),this},bezierTo:function(t,n,r){return this.iIndex=o(this.instructions,this.iIndex,this.applyTransform(this.cache[0],this.getTransform(this.cache[0]),t),this.applyTransform(this.cache[1],this.getTransform(this.cache[1]),n),this.applyTransform(this.cache[2],this.getTransform(this.cache[2]),r)),this},getInstructions:function(){return this.instructions},getTransform:function(t){return 0===this.tIndex?(t[0]=0,t[1]=0):(t[0]=this.transforms[this.tIndex-2],t[1]=this.transforms[this.tIndex-1]),t},applyTransform:function(t,n,r){return 0===this.tIndex?(t[0]=r[0],t[1]=r[1]):h(t,n,r),t},pushTransform:function(t){return this.tIndex=s(this.transforms,this.tIndex,c(this.cache[0],this.getTransform(this.cache[0]),t)),this},pushGlobalTransform:function(t){return this.tIndex=s(this.transforms,this.tIndex,t),this},popTransform:function(){return this.tIndex=u(this.tIndex,this.tLowerBound),this},sequence:function(t,n){var r=this.tIndex,i=this.tLowerBound;return this.tLowerBound=this.tIndex,t(this,n),this.tIndex=r,this.tLowerBound=i,this},branch:function x(t,n){n=n||{},n.instructor=n.instructor||this.instructor;var x=d(Object.create(Object.getPrototypeOf(this)),n);return this.getTransform(x.transforms),x.tLowerBound=2,t(x,n.state),m(x.instructions,x.iIndex)}},l=function(t,n){return t[0]=n[0],t[1]=n[1],t},p=function(t,r){if(void 0!==r&&"object"!==("undefined"==typeof r?"undefined":a(r)))throw TypeError("configuration must be an object");r=r||{};var i=void 0;if(void 0!==r.projection){if("function"!=typeof r.projection)throw TypeError("configuration.projection must be a function");i=r.projection}else i=l;var e=f(t,i),o=[];o[n.moveTo]=e.moveTo,o[n.lineTo]=e.lineTo,o[n.quadTo]=e.quadTo,o[n.bezierTo]=e.bezierTo;var s=function(t){for(var n=0;n<t.length&&t[n]!=-1;)n=o[t[n]](t,n)},u=function(n){var r=m(this.instructions,this.iIndex),i=function(){s(r)};return"function"==typeof n?n(t,i):i(),this.iIndex=0,this},c=d(Object.create(Object.assign({},{commit:u},T)),r);return{sequence:function(t,n){return t(c,n),c.instructions},commit:s}};t.bristle=p,t["default"]=p,Object.defineProperty(t,"__esModule",{value:!0})});