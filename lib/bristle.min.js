!function(r,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):r.bristle=n()}(this,function(){"use strict";function r(r){return r=this.applyTransform(v[0],this.currentTransform,r),this.instructions[0]=p.move(this.instructions,this.instructions[0],r),this}function n(r){return r=this.applyTransform(v[0],this.currentTransform,r),this.instructions[0]=p.line(this.instructions,this.instructions[0],r),this}function t(r){return 1===this.instructions[0]?this.move(r):this.line(r)}function i(r,n){return r=this.applyTransform(v[0],this.currentTransform,r),n=this.applyTransform(v[1],this.currentTransform,n),this.instructions[0]=p.quad(this.instructions,this.instructions[0],r,n),this}function e(r,n,t){return r=this.applyTransform(v[0],this.currentTransform,r),n=this.applyTransform(v[1],this.currentTransform,n),t=this.applyTransform(v[2],this.currentTransform,t),this.instructions[0]=p.bezier(this.instructions,this.instructions[0],r,n,t),this}function o(r,n,t,i,e){return r=this.applyTransform(v[0],this.currentTransform,r),this.instructions[0]=p.arc(this.instructions,this.instructions[0],r,n,t,i,e),this}function s(r,n,t){var i=[];return i[0]=this.currentTransform[0],i[1]=this.currentTransform[1],this.currentTransform=this.mergeTransforms(this.currentTransform,i,r),n(this,t?t:this.state),this.currentTransform[0]=i[0],this.currentTransform[1]=i[1],this}function u(r,n){return r(this,n?n:this.state),this}var a={nil:-1,move:0,line:1,bezier:2,quad:3,arc:4},c=function(r,n,t){return r[n]=a.move,r[n+1]=t[0],r[n+2]=t[1],n+=3},f=function(r,n,t){return r[n]=a.line,r[n+1]=t[0],r[n+2]=t[1],n+=3},h=function(r,n,t,i){return r[n]=a.quad,r[n+1]=t[0],r[n+2]=t[1],r[n+3]=i[0],r[n+4]=i[1],n+=5},l=function(r,n,t,i,e){return r[n]=a.bezier,r[n+1]=t[0],r[n+2]=t[1],r[n+3]=i[0],r[n+4]=i[1],r[n+5]=e[0],r[n+6]=e[1],n+7},m=function(r,n,t,i,e,o,s){return r[n]=a.arc,r[n+1]=t[0],r[n+2]=t[1],r[n+3]=i,r[n+4]=e,r[n+5]=o,r[n+6]=s===!0?1:0,n+7},p={move:c,line:f,quad:h,bezier:l,arc:m},y=new ArrayBuffer(24),v=[new Float32Array(y,0,2),new Float32Array(y,8,2),new Float32Array(y,16,2)],T={seq:s,localSeq:u,move:r,line:n,draw:t,quad:i,bezier:e,arc:o},d=function(r,n,t){return r[0]=n[0]+t[0],r[1]=n[1]+t[1],r},b=function(r,n,t){return d(r,n,t)},q=function(r,n){return b(r,this.currentTransform,n)},w={merge:d,apply:b,applyCurrent:q},z={seq:T.seq,localSeq:T.localSeq,move:T.move,line:T.line,draw:T.draw,quad:T.quad,bezier:T.bezier,applyTransform:w.apply,mergeTransforms:w.merge,applyCurrentTransform:w.applyCurrent},j=function(r){return r=r||{instructions:[]},r.instructions[0]=1,Object.assign({},z,{instructions:r.instructions,currentTransform:r.transform||[0,0]})},C=new ArrayBuffer(24),A=[new Float32Array(C,0,2),new Float32Array(C,8,2),new Float32Array(C,16,2)],S=function(r,n,t,i){var e=r(A[0],t.slice(i+1,i+3));return n.moveTo(e[0],e[1]),i+3},g=function(r,n,t,i){var e=r(A[0],t.slice(i+1,i+3));return n.lineTo(e[0],e[1]),i+3},x=function(r,n,t,i){var e=r(A[0],t.slice(i+1,i+3)),o=r(A[1],t.slice(i+3,i+5));return n.quadraticCurveTo(e[0],e[1],o[0],o[1]),i+5},F=function(r,n,t,i){var e=r(A[0],t.slice(i+1,i+3)),o=r(A[1],t.slice(i+3,i+5)),s=r(A[2],t.slice(i+5,i+7));return n.bezierCurveTo(e[0],e[1],o[0],o[1],s[0],s[1]),i+7},D=function(r,n,t,i){var e=r(A[0],t.slice(i+1,i+3)),o=0!==t[i+6];return n.arc(e[0],e[1],t[i+3],t[i+4],t[i+5],o),i+7},O={move:S,line:g,quad:x,bezier:F,arc:D},B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},E=[];E[a.move]=O.move,E[a.line]=O.line,E[a.quad]=O.quad,E[a.bezier]=O.bezier,E[a.arc]=O.arc;var R={renderOperations:E},k=function(r){if("function"!=typeof r.projection)throw Error("Render configuration must provide a projection function");if("object"!==B(r.canvasContext2D))throw Error("Render canvasContext2D must be an object");var n=Object.assign({},R,{projection:r.projection,canvasContext2D:r.canvasContext2D}),t=function i(r){for(var t=1;t<r[0];)t=n.renderOperations[r[t]](n.projection,n.canvasContext2D,r,t);return i};return t},G=function(r){var n=j(r);return{path:function(r,t){return r(n,t),n.instructions},render:function(r,n){var t=k(r);return n?t(n):t}}};return G});