!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.bristle=n()}(this,function(){"use strict";var t={nil:-1,moveTo:0,lineTo:1,bezierTo:2,quadTo:3,arc:4},n=function(n,r,i){return n[r]=t.moveTo,n[r+1]=i[0],n[r+2]=i[1],r+=3},r=function(n,r,i){return n[r]=t.lineTo,n[r+1]=i[0],n[r+2]=i[1],r+=3},i=function(n,r,i,e){return n[r]=t.quadTo,n[r+1]=i[0],n[r+2]=i[1],n[r+3]=e[0],n[r+4]=e[1],r+=5},e=function(n,r,i,e,o){return n[r]=t.bezierTo,n[r+1]=i[0],n[r+2]=i[1],n[r+3]=e[0],n[r+4]=e[1],n[r+5]=o[0],n[r+6]=o[1],r+7},o=function(n,r,i,e,o,s,c){return n[r]=t.arc,n[r+1]=i[0],n[r+2]=i[1],n[r+3]=e,n[r+4]=o,n[r+5]=s,n[r+6]=c===!0?1:0,r+7},s=function(t,n,r){return t[n]=r[0],t[n+1]=r[1],n+2},c=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Math.max(t-2,Math.max(n,0))},u=function(t,n,r){return t[0]=n[0]+r[0],t[1]=n[1]+r[1],t},h=function(t,n,r){return u(t,n,r)},a=function(t,n){var r=[[0,0],[0,0],[0,0]];return{moveTo:function(i,e){var o=n(r[0],i.slice(e+1,e+3));return t.moveTo(o[0],o[1]),e+3},lineTo:function(i,e){var o=n(r[0],i.slice(e+1,e+3));return t.lineTo(o[0],o[1]),e+3},quadTo:function(i,e){var o=n(r[0],i.slice(e+1,e+3)),s=n(r[1],i.slice(e+3,e+5));return t.quadraticCurveTo(o[0],o[1],s[0],s[1]),e+5},bezierTo:function(i,e){var o=n(r[0],i.slice(e+1,e+3)),s=n(r[1],i.slice(e+3,e+5)),c=n(r[2],i.slice(e+5,e+7));return t.bezierCurveTo(o[0],o[1],s[0],s[1],c[0],c[1]),e+7},arc:function(i,e){var o=n(r[0],i.slice(e+1,e+3)),s=0!==i[e+6];return t.arc(o[0],o[1],i[e+3],i[e+4],i[e+5],s),e+7}}},f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d=function(t,n){return n=n||{},t.instructions=n.instructions||[],t.iIndex=Number.isInteger(n.instructionIndex)?n.instructionIndex:0,t.transforms=n.transforms||[],t.tIndex=Number.isInteger(n.transformIndex)?n.transformIndex:0,t.tLowerBound=Number.isInteger(n.transformLowerBound)?n.transformLowerBound:0,t.instructor=n.instructor,t},m=function(t,n){return n<t.length&&(t[n]=-1),t},T={cache:[[0,0],[0,0],[0,0]],moveTo:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0];return this.iIndex=n(this.instructions,this.iIndex,this.applyTransform(this.cache[0],this.getTransform(this.cache[0]),t)),this},lineTo:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0];return this.iIndex=r(this.instructions,this.iIndex,this.applyTransform(this.cache[0],this.getTransform(this.cache[0]),t)),this},quadTo:function(t,n){return this.iIndex=i(this.instructions,this.iIndex,this.applyTransform(this.cache[0],this.getTransform(this.cache[0]),t),this.applyTransform(this.cache[1],this.getTransform(this.cache[1]),n)),this},bezierTo:function(t,n,r){return this.iIndex=e(this.instructions,this.iIndex,this.applyTransform(this.cache[0],this.getTransform(this.cache[0]),t),this.applyTransform(this.cache[1],this.getTransform(this.cache[1]),n),this.applyTransform(this.cache[2],this.getTransform(this.cache[2]),r)),this},arc:function(t,n,r,i,e){return this.iIndex=o(this.instructions,this.iIndex,this.applyTransform(this.cache[0],this.getTransform(this.cache[0]),t),n,r,i,e),this},getInstructions:function(){return this.instructions},getTransform:function(t){return 0===this.tIndex?(t[0]=0,t[1]=0):(t[0]=this.transforms[this.tIndex-2],t[1]=this.transforms[this.tIndex-1]),t},applyTransform:function(t,n,r){return 0===this.tIndex?(t[0]=r[0],t[1]=r[1]):h(t,n,r),t},pushTransform:function(t){return this.tIndex=s(this.transforms,this.tIndex,u(this.cache[0],this.getTransform(this.cache[0]),t)),this},pushGlobalTransform:function(t){return this.tIndex=s(this.transforms,this.tIndex,t),this},popTransform:function(){return this.tIndex=c(this.tIndex,this.tLowerBound),this},sequence:function(t,n){var r=this.tIndex,i=this.tLowerBound;return this.tLowerBound=this.tIndex,t(this,n),this.tIndex=r,this.tLowerBound=i,this},branch:function x(t,n){n=n||{},n.instructor=n.instructor||this.instructor;var x=d(Object.create(Object.getPrototypeOf(this)),n);return this.getTransform(x.transforms),x.tLowerBound=2,t(x,n.state),m(x.instructions,x.iIndex)}},p=function(t,n){return t[0]=n[0],t[1]=n[1],t},l=function(n,r){if(void 0!==r&&"object"!==("undefined"==typeof r?"undefined":f(r)))throw TypeError("configuration must be an object");r=r||{};var i=void 0;if(void 0!==r.projection){if("function"!=typeof r.projection)throw TypeError("configuration.projection must be a function");i=r.projection}else i=p;var e=a(n,i),o=[];o[t.moveTo]=e.moveTo,o[t.lineTo]=e.lineTo,o[t.quadTo]=e.quadTo,o[t.bezierTo]=e.bezierTo,o[t.arc]=e.arc;var s=function(t){for(var n=0;n<t.length&&t[n]!=-1;)n=o[t[n]](t,n)},c=function(t){var r=m(this.instructions,this.iIndex),i=function(){s(r)};return"function"==typeof t?t(n,i):i(),this.iIndex=0,this},u=d(Object.create(Object.assign({},{commit:c},T)),r);return{sequence:function(t,n){return t(u,n),u.instructions},commit:s}};return l});