!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t=t||self).bristle=n()}(this,(function(){"use strict";var t="undefined"!=typeof Float32Array?Float32Array:Array;function n(){var n=new t(6);return t!=Float32Array&&(n[1]=0,n[2]=0,n[4]=0,n[5]=0),n[0]=1,n[3]=1,n}function o(t,n,o){var r=n[0],c=n[1],a=n[2],e=n[3],u=n[4],i=n[5],f=o[0],h=o[1],l=o[2],p=o[3],v=o[4],s=o[5];return t[0]=r*f+a*h,t[1]=c*f+e*h,t[2]=r*l+a*p,t[3]=c*l+e*p,t[4]=r*v+a*s+u,t[5]=c*v+e*s+i,t}function r(){var n=new t(2);return t!=Float32Array&&(n[0]=0,n[1]=0),n}function c(t,n,o){var r=n[0],c=n[1];return t[0]=o[0]*r+o[2]*c+o[4],t[1]=o[1]*r+o[3]*c+o[5],t}Math.hypot||(Math.hypot=function(){for(var t=0,n=arguments.length;n--;)t+=arguments[n]*arguments[n];return Math.sqrt(t)});a=r();var a,e=n(),u=r(),i=r(),f=r();return function(t){var a=t.ctx2d,h=t.pathState,l=t.outputToString,p=void 0!==l&&l;if(!a&&!p)throw Error("Must provide a canvas 2d context or activate output to string");var v={branchDepth:0,transformStack:[n()],controlCount:0,controlPoints:[r(),r]};p&&(v.pathString="");var s,T=p?function(t){return{moveTo:function(n){return t.pathString+="M".concat(n[0],",").concat(n[1])},lineTo:function(n){return t.pathString+="L".concat(n[0],",").concat(n[1])},quadTo:function(n,o){return t.pathString+="Q".concat(n[0],",").concat(n[1],",").concat(o[0],",").concat(o[1])},bezierTo:function(n,o,r){return t.pathString+="C".concat(n[0],",").concat(n[1],",").concat(o[0],",").concat(o[1],",").concat(r[0],",").concat(r[1])}}}(v):function(t){return{moveTo:function(n){return t.moveTo(n[0],n[1])},lineTo:function(n){return t.lineTo(n[0],n[1])},quadTo:function(n,o){return t.quadraticCurveTo(n[0],n[1],o[0],o[1])},bezierTo:function(n,o,r){return t.bezierCurveTo(n[0],n[1],o[0],o[1],r[0],r[1])}}}(a),b=function(){return v.transformStack[v.branchDepth]},d=[function(t){T.lineTo(c(u,t,b()))},function(t){var n=b();T.quadTo(c(u,v.controlPoints[0],n),c(i,t,n)),v.controlCount=0},function(t){var n=b();T.bezierTo(c(u,v.controlPoints[0],n),c(i,v.controlPoints[1],n),c(f,t,n)),v.controlCount=0}],m={moveTo:function(t){return T.moveTo(c(u,t,b())),s},pathTo:function(t){return d[v.controlCount](t),s},controlAt:function(t){if(v.controlCount>1)throw Error("Attempt to assign too many control points");var n,o;return n=v.controlPoints[v.controlCount],o=t,n[0]=o[0],n[1]=o[1],v.controlCount+=1,s},localToGlobal:function(t,n){return c(t,n,b())},globalToLocal:function(t,n){return function(t,n){var o=n[0],r=n[1],c=n[2],a=n[3],e=n[4],u=n[5],i=o*a-r*c;i&&(i=1/i,t[0]=a*i,t[1]=-r*i,t[2]=-c*i,t[3]=o*i,t[4]=(c*u-a*e)*i,t[5]=(r*e-o*u)*i)}(e,b()),c(t,n,e)},branch:function(t,r){var c,a,e,u;r&&(c=r,a=b(),e=v.branchDepth,(u=v.transformStack).length<=e+1?u.push(o(n(),c,a)):o(u[e+1],c,a),v.branchDepth+=1),t(s,h),r&&(v.branchDepth=Math.max(0,v.branchDepth-1))}};return m.m=m.moveTo,m.p=m.pathTo,m.c=m.controlAt,m.b=m.branch,s=Object.assign(Object.create(m),{ctx2d:a}),p?function(t,n){return v.pathString="",s.branch(t,n),v.pathString}:s.branch}}));
