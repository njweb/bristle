!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("gl-matrix/esm/mat2d"),require("gl-matrix/esm/vec2")):"function"==typeof define&&define.amd?define(["gl-matrix/esm/mat2d","gl-matrix/esm/vec2"],n):(t=t||self).bristle=n(t.mat2d,t.vec2)}(this,(function(t,n){"use strict";var o=t.create(),r=n.create(),c=n.create(),e=n.create();return function(a){var i=a.ctx2d,u=a.pathState,f=a.outputToString,l=void 0!==f&&f;if(!i&&!l)throw Error("Must provide a canvas 2d context or activate output to string");var s={branchDepth:0,transformStack:[t.create()],controlCount:0,controlPoints:[n.create(),n.create]};l&&(s.pathString="");var m,h=l?function(t){return{moveTo:function(n){return t.pathString+="M".concat(n[0]," ").concat(n[1])},lineTo:function(n){return t.pathString+="L".concat(n[0]," ").concat(n[1])},quadTo:function(n,o){return t.pathString+="Q".concat(n[0]," ").concat(n[1]," ").concat(o[0]," ").concat(o[1])},bezierTo:function(n,o,r){return t.pathString+="C".concat(n[0]," ").concat(n[1]," ").concat(o[0]," ").concat(o[1]," ").concat(r[0]," ").concat(r[1])}}}(s):function(t){return{moveTo:function(n){return t.moveTo(n[0],n[1])},lineTo:function(n){return t.lineTo(n[0],n[1])},quadTo:function(n,o){return t.quadraticCurveTo(n[0],n[1],o[0],o[1])},bezierTo:function(n,o,r){return t.bezierCurveTo(n[0],n[1],o[0],o[1],r[0],r[1])}}}(i),p=function(){return s.transformStack[s.branchDepth]},d=[function(t){h.lineTo(n.transformMat2d(r,t,p()))},function(t){var o=p();h.quadTo(n.transformMat2d(r,s.controlPoints[0],o),n.transformMat2d(c,t,o)),s.controlCount=0},function(t){var o=p();h.bezierTo(n.transformMat2d(r,s.controlPoints[0],o),n.transformMat2d(c,s.controlPoints[1],o),n.transformMat2d(e,t,o)),s.controlCount=0}],v={moveTo:function(t){return h.moveTo(n.transformMat2d(r,t,p())),m},pathTo:function(t){return d[s.controlCount](t),m},setControl:function(t){if(s.controlCount>1)throw Error("Attempt to assign too many control points");return n.copy(s.controlPoints[s.controlCount],t),s.controlCount+=1,m},localToGlobal:function(t,o){return n.transformMat2d(t,o,p())},globalToLocal:function(r,c){return t.invert(o,p()),n.transformMat2d(r,c,o)},branch:function(n,o){var r,c,e,a;o&&(r=o,c=p(),e=s.branchDepth,(a=s.transformStack).length<=e+1?a.push(t.multiply(t.create(),r,c)):t.multiply(a[e+1],r,c),s.branchDepth+=1),n(m,u),o&&(s.branchDepth=Math.max(0,s.branchDepth-1))}};return v.m=v.moveTo,v.p=v.pathTo,v.c=v.setControl,v.b=v.branch,m=Object.assign(Object.create(v),{ctx2d:i}),l?function(t,n){return s.pathString="",m.branch(t,n),s.pathString}:m.branch}}));
